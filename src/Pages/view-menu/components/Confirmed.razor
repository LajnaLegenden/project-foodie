@inject Blazored.LocalStorage.ILocalStorageService localStorage
@using project_foodie.Data
@using project_foodie.Pages.view_menu.components
@using project_foodie.Model;
@using project_foodie.Modules;
@using project_foodie.Repository;
@using Newtonsoft.Json;
@using Newtonsoft.Json.Linq;
@inject NavigationManager NavManager

@if (dataLoaded) {
    <div class="confirmedContainer">
        <div class="title">
            <h1>Beställningen är nu bekräftad!</h1>
        </div>
        <div class="infoContainer">
            <div class="logoContainer">
                <img src="/images/confetti.png"/>
            </div>
            <div class="information">
                <div class="parameters">
                    <h2>Namn:</h2>
                    <h2>Beställningsdag:</h2>
                    <h2>Antal beställda dagar:</h2>
                    <h2>Leveransdatum:</h2>
                    <h2>Totalt Pris:</h2>
                </div>
                <div class="inputs">
                    <h2>Thomas Andersson</h2>
                    <h2>@getOrderDate()</h2>
                    <h2>@getCountOrderdDays()</h2>
                    <h2>2023-03-06</h2>
                    <h2>@getTotalPrice():-</h2>
                </div>
            </div>
        </div>
        <div class="buttonContainer">
            <button @onclick="@(()=>NavManager.NavigateTo("/"))">Klart</button>
        </div>
    </div>
} else {
    <div class="loading">
        <h1>Loading...</h1>
    </div>
}

@code {
    [Parameter]
    public Menu menu { get; set; }

    private List<LocalStorage.Row> data;

    public bool dataLoaded = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(!dataLoaded){
            data = await LocalStorage.LoadData(localStorage, menu);
            dataLoaded = true;
            StateHasChanged();
        }
    }

    private string getOrderDate() {
        return DateTime.Now.ToString("yyyy-MM-dd");
    }

    private int getTotalPrice()
    {
        int Total = 0;
        foreach (LocalStorage.Row r in data)
        {
            Total += r.LunchPrice + r.DinnerPrice;
        }
        return Total;
    }

    private int getCountOrderdDays() {
        int count = 0;
        foreach (LocalStorage.Row r in data) {
            count++;
        }
        return count;
    }
}